function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var s=[],i=!0,r=!1,o=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(s.push(n.value),!t||s.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return s}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var defaults={src:"",poster:"",type:"",showControls:!0,showControlsOnHover:!0,controlsHoverSensitivity:3e3,showScrubber:!0,showTimer:!1,showPlayPauseBtn:!0,showSoundControl:!1,showFullScreen:!1,keyboardControls:!0,themeClass:"rtopTheme",fontAwesomeControlIcons:!0,autoPlay:!1,loop:!1,allowReplay:!0,playInModal:!1,showCloseBtn:!1,closeModalOnFinish:!1,gtmOptions:{}},config={version:"1.1.0",updated:"05.15.19"},vimeo={isVimeo:function(e){return/^https?:\/\/vimeo.com\/\d{0,9}(?=\b|\/)/.test(e)}},youtube={isYoutube:function(e){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(e)}};function wrap(e,t){var s=e.length?e:[e];Array.from(s).reverse().forEach(function(e,s){var i=s>0?t.cloneNode(!0):t,r=e.parentNode,o=e.nextSibling;i.appendChild(e),o?r.insertBefore(i,o):r.appendChild(i)})}function createElement(e,t,s){var i=document.createElement(e);return setAttributes(i,t),s&&""!==s&&(i.innerText=s),i}function setAttributes(e,t){t&&0!==Object.keys(t).length&&Object.entries(t).forEach(function(t){var s=_slicedToArray(t,2),i=s[0],r=s[1];return e.setAttribute(i,r)})}function prepend(e,t){e.insertBefore(t,e.children[0])}function remove(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function addClass(e,t){return e.classList.add(t),e.classList.contains(t)}function removeClass(e,t){return e.classList.remove(t),e.classList.contains(t)}function hasClass(e,t){return e.classList.contains(t)}function html(e,t){e.innerHTML=t}function generateRandomId(){return Math.random().toString(36).substr(2,12)}function timeFormat(e){return[Math.floor(e/60)%60,Math.floor(e%60)].map(function(e,t){return(e<10?"0":"")+e}).join(":")}function runPrefixMethod(e,t){for(var s,i,r=["webkit","moz","ms","o",""],o=0;o<r.length&&!e[s];){if(s=t,""==r[o]&&(s=s.substr(0,1).toLowerCase()+s.substr(1)),s=r[o]+s,"undefined"!=(i=_typeof(e[s])))return r=[r[o]],"function"==i?e[s]():e[s];o++}}var video={init:function(){var e=this._element.querySelector("video");this._randomId=generateRandomId(),e&&(this._video.player=e,this._video.src=e.getAttribute("src"),this._video.poster=e.getAttribute("poster"),this._video.type=e.getAttribute("type"),e.getAttribute("id")||setAttributes(e,_id)),this._element.getAttribute("data-video")&&(this._video.src=this._element.getAttribute("data-video"),this._video.poster=this._element.getAttribute("data-poster"),this._video.type=this._element.getAttribute("data-type"),this._video.createTag=!0),""!==this._settings.src&&(this._video.isVimeo=vimeo.isVimeo(this._settings.src),this._video.isYoutube=youtube.isYoutube(this._settings.src),this._video.isVimeo||this._video.isYoutube?this._video.external=!0:this._video.createTag=!0,this._video.src=this._settings.src,this._video.poster=this._settings.poster,this._video.type=this._settings.src.type),this._video.src?(this._video.isVimeo&&vimeo.loadVimeo(),this._video.isYoutube&&youtube.loadYoutube(),this._video.createTag&&video.createTag.call(this)):console.log("There was an error loading your video, please check documentation --\x3e https://redtettemer.github.io/rtop-video-player/")},createTag:function(){var e=createElement("source",{src:this._video.src,type:this._video.type}),t=createElement("video",{src:this._video.src,poster:this._video.poster,type:this._video.type,playsinline:!0,id:this._randomId});t.append(e),this._element.append(t),this._video.player=t}};function checkTaging(e){if(void 0!==("undefined"==typeof dataLayer?"undefined":_typeof(dataLayer))){for(var t in dataLayer)if(dataLayer[t].event===e)return!0;return!1}return!0}function sendTag(e,t){dataLayer.push({type:t})}var controls={pause:function(){this.pause()},play:function(){this.play()},playPauseRepeat:function(){hasClass(this._playerWrapper,"playing")?this.pause():hasClass(this._playerWrapper,"finished")?this._settings.allowReplay&&this.restart():this.play()},videoMove:function(){this._settings.showControls&&hasClass(this._playerWrapper,"hideOverlay")&&(this._timers&&this._timers._motion_timer&&clearTimeout(this._timers._motion_timer),removeClass(this._playerWrapper,"hideOverlay"),removeClass(this._playerWrapper.querySelector(".vidControls"),"hide"))},videoOut:function(){var e=this;!this._video.player.paused&&this._settings.showControls&&(this._timers&&this._timers._motion_timer&&clearTimeout(this._timers._motion_timer),this._timers||(this._timers={}),this._timers._motion_timer=setTimeout(function(){addClass(e._playerWrapper,"hideOverlay"),addClass(e._playerWrapper.querySelector(".vidControls"),"hide")},this._settings.controlsHoverSensitivity))},progressClick:function(e){e.stopPropagation();var t=e.pageX-this._controls.progressholder.element.offsetLeft-this._playerWrapper.parentNode.parentNode.offsetLeft,s=this._controls.progressholder.element.offsetWidth;this._video.player&&this.goto(t/s*this._video.player.duration)},progressMove:function(e){var t=this._playerWrapper.querySelector("#progressorb"),s=e.pageX-this._controls.progressholder.element.offsetLeft-this._playerWrapper.parentNode.parentNode.offsetLeft-t.offsetWidth/2,i=this._controls.progressholder.element.offsetWidth-t.offsetWidth/2;t.style.left=s>i?i:s+"px"},mute:function(){this._controls.isMute?this.adjustVolume(this._controls.volume):this.mute()},adjustVolume:function(e){this.adjustVolume(e.getAttribute("data-value"))},fullscreen:function(){this._controls.isFs?(this._controls.isFs=!1,runPrefixMethod(document,"CancelFullScreen")):(this._controls.isFs=!0,runPrefixMethod(this._playerWrapper,"RequestFullScreen"))},close:function(){this.close()},updateProgress:function(){var e=this;this._video.player&&(this._settings.showTimer&&(html(this._controls.time.current.element,timeFormat(this._video.player.currentTime)),html(this._controls.time.total.element,timeFormat(this._video.player.duration))),this._settings.showScrubber&&(this._controls.buffered.element.style.width=this._video.player.buffered.end(this._video.player.buffered.length-1)/this._video.player.duration*100+"%",this._controls.progress.element.style.width=this._video.player.currentTime/this._video.player.duration*100+"%"),Object.keys(this._settings.gtmOptions).length>0&&"undefined"!=typeof dataLayer&&Object.keys(this._settings.gtmOptions).map(function(t){Math.floor(e._video._player.currentTime/e._video._player.duration*100)===parseFloat(e._settings.gtmOptions[t].time)&&(checkTaging(e._settings.gtmOptions[t].name)||sendTag(e._settings.gtmOptions[t].type,name))}),this._video.player.ended&&controls.videoEnded.call(this))},autoPlay:function(){var e=this;this._playerWrapper.addClass("playing"),this._video.player.muted=!0,this._video.player.volume=0,this._video.player.autoplay=!0,this._video.player.load(),this._settings.showControls&&(this._timers&&this._timers._motion_timer&&clearTimeout(this._timers._motion_timer),this._timers||(this._timers={}),this._timers._motion_timer=setTimeout(function(){addClass(e._playerWrapper,"hideOverlay"),addClass(e._playerWrapper.querySelector(".vidControls"),"hide")},this._settings.controlsHoverSensitivity))},openModal:function(){addClass(this._modal,"show")},keyboardControls:function(e){if(32===e.keyCode)return e.preventDefault(),e.stopPropagation(),void(hasClass(this._playerWrapper,"playing")?this.pause():hasClass(this._playerWrapper,"finished")?this._settings.allowReplay&&this.restart():this.play())},videoEnded:function(){if(removeClass(this._playerWrapper,"playing"),removeClass(this._playerWrapper,"pause"),removeClass(this._playerWrapper,"hideOverlay"),addClass(this._playerWrapper,this._settings.closeModalOnFinish?"closing":"finished"),addClass(this._playerWrapper.querySelector(".vidControls"),"hide"),this._timers&&(this._timers._progress&&clearInterval(this._timers._progress),this._timers._motion_timer&&clearTimeout(this._timers._motion_timer)),this._settings.loop)this.restart();else if(this._settings.closeModalOnFinish){var e=this;setTimeout(function(){e.stop(),removeClass(e._modal,"show")},300)}}};function buildWrapper(){var e=createElement("div",{class:"rtopVideoPlayerWrapper"}),t=createElement("div",{class:"rtopVideoHolder"+(this._settings.fontAwesomeControlIcons?" hasFAIcons":"")});wrap(this._video.player,t),this._playerWrapper=createElement("div",{class:"rtopVideoPlayer "+this._settings.themeClass+(this._settings.fontAwesomeControlIcons?" hasFA":"")}),this._playerWrapper.append(t),e.append(this._playerWrapper),this._settings.playInModal?buildModal.call(this,e):this._element.append(e)}function buildModal(e){var t=this;if(this._settings.playInModal){var s=createElement("div",{class:"rtopVideoModal",id:this._randomId+"_modal"}),i=createElement("div",{class:"videoModalHolder"});if(i.append(e),s.append(i),document.body&&document.body.append(s),this._modal=s,!this._video.isVimeo&&!this._video.isYoutube){var r=createElement("div",{class:"rtopVideoPosterImage"+(this._settings.fontAwesomeControlIcons?" hasFAIcons":"")}),o=createElement("img",{src:this._video.poster});r.append(o)}if(this._controls||(this._controls={}),this._controls={modalPoster:{element:poster,events:{click:poster.addEventListener("click",function(){return controls.openModal.call(t)},!0)}}},this._element.append(poster),this._settings.showCloseBtn){var n=buildFontAwesomeButton.call(this,"closeVideo","far fa-times-circle");i.append(n),this._controls.closeModal={element:n,events:{click:n.addEventListener("click",function(){return controls.close.call(t)},!0)}}}}}function buildControls(){var e=this,t=createElement("div",{class:"vidControls"+(this._settings.fontAwesomeControlIcons?" hasFAIcons":"")});if(this._playerWrapper.append(t),this._controls||(this._controls={}),this._controls.video={element:this._playerWrapper.querySelector(".rtopVideoHolder"),events:{click:this._playerWrapper.querySelector(".rtopVideoHolder").addEventListener("click",function(){return controls.playPauseRepeat.call(e)},!0),mousemove:this._playerWrapper.querySelector(".rtopVideoHolder").addEventListener("mousemove",function(){return controls.videoMove.call(e)},!0),mouseout:this._playerWrapper.querySelector(".rtopVideoHolder").addEventListener("mouseout",function(){return controls.videoOut.call(e)},!0)}},this._settings.keyboardControls&&(this._controls.keyboard={events:document.addEventListener("keyup",function(t){return controls.keyboardControls.call(e,t)},!0)}),this._settings.showPlayPauseBtn)buildPlayBtn.call(this);else{addClass(t,"noPP");var s=createElement("div",{className:"controlBtn",id:"playPauseHolder"});videoControls.append(s)}if(this._settings.showScrubber)buildProgressBar.call(this);else{addClass(t,"noProgressBar");var i=createElement("div",{className:"controlBtn",id:"progressSpacer"});videoControls.append(i)}this._settings.showTimer&&buildTimer.call(this),this._settings.showSoundControl&&buildSoundControl.call(this),this._settings.showFullScreen&&buildFullScreen.call(this),this._settings.autoPlay&&controls.autoPlay.call(this)}function buildPauseBtn(){var e=this,t=this._playerWrapper.querySelector(".vidControls");addClass(t,"hasPP");var s=buildFontAwesomeButton.call(this,"playPause","far fa-pause-circle");prepend(t,s),this._controls.pause={element:s,events:{click:s.addEventListener("click",function(){return controls.pause.call(e)},!0)},info:{event:"pause"}}}function buildPlayBtn(){var e=this,t=this._playerWrapper.querySelector(".vidControls");addClass(t,"hasPP");var s=buildFontAwesomeButton.call(this,"playPause","far fa-play-circle");prepend(t,s),this._controls.play={element:s,events:{click:s.addEventListener("click",function(){return controls.play.call(e)},!0)},info:{event:"play"}}}function buildProgressBar(){var e=this,t=this._playerWrapper.querySelector(".vidControls");addClass(t,"hasProgressBar");var s=createElement("div",{class:"controlBtn",id:"progressholder"});this._controls.progressholder={element:s,events:{click:s.addEventListener("click",function(t){return controls.progressClick.call(e,t)},!0),mousemove:s.addEventListener("mousemove",function(t){return controls.progressMove.call(e,t)},!0)}};var i=createElement("div",{id:"fullvideoprogress"}),r=createElement("div",{id:"buffered"});this._controls.buffered={element:r};var o=createElement("div",{id:"progress"});this._controls.progress={element:o};var n=createElement("div",{id:"progressorb"});this._controls.progressorb={element:n},s.append(i),s.append(r),s.append(o),s.append(n),t.append(s)}function buildTimer(){var e=this._playerWrapper.querySelector(".vidControls");addClass(e,"hasTimer");var t=createElement("div",{class:"controlBtn",id:"timeholder"}),s=createElement("span",{id:"currenttime"},"00:00"),i=createElement("span",{}," / "),r=createElement("span",{id:"totaltime"},"00:00");t.append(s),t.append(i),t.append(r),e.append(t),this._controls.time={current:{element:s},total:{element:totaltime}}}function buildSoundControl(){var e=this,t=this._playerWrapper.querySelector(".vidControls");addClass(t,"hasSound");var s=createElement("div",{class:"controlBtn",id:"soundControl"}),i=createElement("span",{class:"soundBars"});this._controls.volume=1,Array(4).fill().map(function(t,s){var r=createElement("span",{class:"soundBar active","data-value":.25*(s+1)});i.append(r),e._controls["soundBar"+s]={element:r,events:{click:r.addEventListener("click",function(){return controls.adjustVolume.call(e,r)},!0)}}}),s.append(i),t.append(s),buildSoundBtn.call(this)}function buildSoundBtn(){var e=this,t=createElement("span",{class:"muteBtn"+(this._settings.fontAwesomeControlIcons?" FAIcon":" localAsset")}),s=createElement("i",{class:"fas fa-volume-up"});this._settings.fontAwesomeControlIcons&&t.append(s),this._controls.mute={element:t,events:{click:t.addEventListener("click",function(){return controls.mute.call(e)},!0)}},prepend(this._playerWrapper.querySelector("#soundControl"),t)}function buildMuteBtn(){var e=this,t=createElement("span",{class:"muteBtn isMuted"+(this._settings.fontAwesomeControlIcons?" FAIcon":" localAsset")}),s=createElement("i",{class:"fas fa-volume-mute"});this._settings.fontAwesomeControlIcons&&t.append(s),this._controls.mute={element:t,events:{click:t.addEventListener("click",function(){return controls.mute.call(e)},!0)}},prepend(this._playerWrapper.querySelector("#soundControl"),t)}function buildFullScreen(){var e=this,t=this._playerWrapper.querySelector(".vidControls");addClass(t,"hasFS");var s=buildFontAwesomeButton.call(this,"fullScreenBtn","fas fa-expand");t.append(s),this._controls.fullscreen={element:s,events:{click:s.addEventListener("click",function(){return controls.fullscreen.call(e)},!0)}}}function buildFontAwesomeButton(e,t){var s=createElement("div",{class:"controlBtn",id:e}),i=createElement("span",{class:this._settings.fontAwesomeControlIcons?"FAIcon":"localAsset"}),r=createElement("i",{class:t});return this._settings.fontAwesomeControlIcons&&i.append(r),s.append(i),s}var getConstructor=function(e){return null!=e?e.constructor:null};function clone(e){return JSON.parse(JSON.stringify(e))}function extend(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];if(!s.length)return e;var r=s.shift();return getConstructor(r)!==Object?e:(Object.keys(r).forEach(function(t){getConstructor(r[t])===Object?(Object.keys(e).includes(t)||Object.assign(e,_defineProperty({},t,{})),extend(e[t],r[t])):Object.assign(e,_defineProperty({},t,r[t]))}),extend.apply(void 0,[e].concat(s)))}function listener(e,t,s,i){var r=this;t.split(" ").forEach(function(t){r._eventListeners&&i&&r._eventListeners.push({element:e,type:t,callback:s}),e[i?"addEventListener":"removeEventListener"](t,function(){s({event:t})},{bubbles:!0})})}function on(e,t,s){listener.call(this,e,t,s,!0)}function off(e,t,s){listener.call(this,e,t,s,!1)}function unbindAll(){this._eventListeners&&(this._eventListeners.forEach(function(e){var t=e.element,s=e.type,i=e.callback,r=e.options;t.removeEventListener(s,i,r)}),this._eventListeners=[])}var VideoPlayer=function(){function e(t,s){_classCallCheck(this,e),t?(this._element=document.querySelector(t),this._name="RTOP_VideoPlayer",this._version=config.version,this._updated=config.updated,this._video={},this._eventListeners=[],this._settings=extend({},defaults,e.settings,s||{}),video.init.call(this),buildWrapper.call(this),this._settings.showControls?buildControls.call(this):!this._settings.showControls&&this._settings.autoPlay&&(this._video.isVimeo||this._video.isYoutube||controls.autoPlay.call(this)),this._settings.showControls||addClass(this._playerWrapper,"noControls"),this._original=this._element.cloneNode(!0)):console.log("There was an error loading your video, please check documentation --\x3e https://redtettemer.github.io/rtop-video-player/")}return _createClass(e,[{key:"play",value:function(){var e=this;if(this._video.player){if(addClass(this._playerWrapper,"playing"),removeClass(this._playerWrapper,"paused"),remove(this._controls.play.element),buildPauseBtn.call(this),this._settings.showControls&&(this._settings.showScrubber||this._settings.showTimer)){var t=this;this._timers||(this._timers={}),this._timers._progress=setInterval(function(){controls.updateProgress.call(t)},100)}return this._settings.showControls&&(this._timers&&this._timers._motion_timer&&clearTimeout(this._timers._motion_timer),this._timers||(this._timers={}),this._timers._motion_timer=setTimeout(function(){addClass(e._playerWrapper,"hideOverlay"),addClass(e._playerWrapper.querySelector(".vidControls"),"hide")},this._settings.controlsHoverSensitivity)),this._video.player.play()}}},{key:"pause",value:function(){this._video.player&&(addClass(this._playerWrapper,"paused"),removeClass(this._playerWrapper,"playing"),remove(this._controls.pause.element),buildPlayBtn.call(this),this._video.player.pause())}},{key:"stop",value:function(){this._video.player&&(this.pause(),this._settings.showControls&&((this._settings.showScrubber||this._settings.showTimer)&&clearInterval(this._timers._progress),clearTimeout(this._timers._motion_timer),removeClass(this._playerWrapper,"finished"),removeClass(this._playerWrapper.querySelector(".vidControls"),"hide")),this._video.player.currentTime=0)}},{key:"restart",value:function(){this._video.player&&(this._settings.showControls&&(this._settings.showPlayPauseBtn&&remove(this._controls.pause.element),(this._settings.showScrubber||this._settings.showTimer)&&clearInterval(this._timers._progress),clearTimeout(this._timers._motion_timer),removeClass(this._playerWrapper,"finished"),removeClass(this._playerWrapper.querySelector(".vidControls"),"hide")),this._video.player.currentTime=0,this.play())}},{key:"goto",value:function(e){this._video.player&&(this._video.player.currentTime=e)}},{key:"mute",value:function(){var e=this;this._video.player&&(this._video.player.muted=!0,this._controls.isMute=!0,remove(this._controls.mute.element),buildMuteBtn.call(this),Array(4).fill().map(function(t,s){removeClass(e._controls["soundBar"+s].element,"active")}))}},{key:"adjustVolume",value:function(e){var t=this;if(this._video.player){var s=e||1;(s=Number(s))>1&&(s=1),s<0&&(s=0),this._controls.isMute&&(this._video.player.muted=!1,this._controls.isMute=!1,remove(this._controls.mute.element),buildSoundBtn.call(this)),this._video.player.volume=s,Array(4).fill().map(function(e,i){Number(t._controls["soundBar"+i].element.getAttribute("data-value"))<=s?addClass(t._controls["soundBar"+i].element,"active"):removeClass(t._controls["soundBar"+i].element,"active")}),this._controls.volume=s}}},{key:"closeModal",value:function(){this.stop(),removeClass(this._modal,"show")}},{key:"on",value:function(e,t){on.call(this,this._video.player,e,t)}},{key:"off",value:function(e,t){off(this._elements,e,t)}},{key:"destroy",value:function(){this._video.player&&(this._video.player.pause(),this._timers&&(this._settings.showControls&&(this._settings.showScrubber||this._settings.showTimer)&&clearInterval(this._timers._progress),this._settings.showControls&&clearTimeout(this._timers._motion_timer)),unbindAll.call(this),remove(document.querySelector(".rtopVideoPlayerWrapper")),this._video.createTag||video.createTag.call(this))}}]),e}();VideoPlayer.settings=clone(defaults);export default VideoPlayer;